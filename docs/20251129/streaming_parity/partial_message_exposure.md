# Partial Message Exposure Gap

- **Whatâ€™s missing:** When `include_partial_messages` is enabled, the Elixir `Client.stream_messages/1` API drops streaming events. The CLI emits `stream_event` frames, but `Client` routes them to mailbox messages (`{:stream_event, ref, event}`) that the public stream never consumes. Python surfaces these as `StreamEvent` items in the same iterator as other messages.
- **Evidence (Python):** `anthropics/claude-agent-sdk-python/src/claude_agent_sdk/_internal/message_parser.py:83-133` parses `"stream_event"` into `StreamEvent` dataclasses, and `ClaudeSDKClient.receive_messages` yields them alongside assistant/result messages.
- **Evidence (Elixir):** `lib/claude_agent_sdk/client.ex:107-147` classifies `:stream_event` and calls `handle_stream_event`, which sends `{:stream_event, ref, event}` to subscribers. `stream_messages/1` (`client.ex:78-119`) only yields `{:claude_message, message}` notifications, so partial events never reach callers. The separate `ClaudeAgentSDK.Streaming` module streams deltas but lacks hooks/permission callbacks/control-protocol integration.
- **Impact:** Elixir users cannot consume partial text/tool/thinking deltas from the control-aware Client (hooks, permissions, SDK MCP) even though the CLI emits them. This breaks parity with Python for typewriter-style UIs and incremental tool input visibility in controlled sessions.
- **Proposed fix:** Extend `Client.stream_messages/1` (or add a companion API) to forward streaming events in-band (e.g., tagged tuples or unified event structs), and document how partial events interleave with Message frames. Cover with tests using mocked `stream_event` payloads and real CLI when available.
